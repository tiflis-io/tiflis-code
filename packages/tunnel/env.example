# Tiflis Code Tunnel Server - Environment Configuration
#
# Copy this file to .env.local for development
# or set these as environment variables in production.
#
# Copyright (c) 2025 Roman Barinov <rbarinov@gmail.com>
# Licensed under the MIT License.

# ============================================================================
# Server Configuration
# ============================================================================

# Environment mode (development, production, test)
NODE_ENV=development

# Server port
PORT=3001

# Host to bind to (use 0.0.0.0 to accept connections from all interfaces)
HOST=0.0.0.0

# Log level (trace, debug, info, warn, error, fatal)
LOG_LEVEL=debug

# ============================================================================
# Security
# ============================================================================

# API key for workstation registration (minimum 32 characters)
# Generate with: openssl rand -base64 32
TUNNEL_REGISTRATION_API_KEY=your-32-character-api-key-here!!

# ============================================================================
# Reverse Proxy Configuration
# ============================================================================
# Use these settings when deploying behind nginx, Traefik, or other reverse proxy.

# Set to true if running behind a reverse proxy that handles TLS
# When true, the server trusts X-Forwarded-* headers
TRUST_PROXY=false

# Public URL for the tunnel server (including protocol)
# This is used to generate the public_url in workstation registration response.
# Example: wss://tunnel.example.com
# If not set, auto-generated based on HOST and PORT.
# PUBLIC_BASE_URL=wss://tunnel.example.com

# WebSocket path (default: /ws)
# WS_PATH=/ws

# ============================================================================
# Example: Running behind nginx with TLS offload
# ============================================================================
# TRUST_PROXY=true
# PUBLIC_BASE_URL=wss://tunnel.example.com
# PORT=3001  # Internal port, nginx proxies from 443 to 3001
#
# nginx.conf example:
#
# upstream tunnel {
#     server 127.0.0.1:3001;
# }
#
# server {
#     listen 443 ssl http2;
#     server_name tunnel.example.com;
#
#     ssl_certificate /path/to/cert.pem;
#     ssl_certificate_key /path/to/key.pem;
#
#     location / {
#         proxy_pass http://tunnel;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_read_timeout 86400;
#     }
#
#     location /health {
#         proxy_pass http://tunnel/health;
#     }
# }

